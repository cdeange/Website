<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animatable.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel='import' href='../../bower_components/paper-styles/typography.html'>
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/shadycss/apply-shim.html">

<dom-module id="resume-app">
<link rel="import" group="home" href="../about-me/about-me.html">
<link rel="import" group="resume" href="../my-resume/my-resume.html">
<template>
  <style>

  .content {
    height: 100%;
  }

  neon-animated-pages {
    @apply --layout-fullbleed;
    @apply --layout-vertical;
    height: 100%;
  }

  neon-animatable {
    @apply --layout-vertical;
    @apply --layout-center-justified;
    height: 100%;
  }

  div.cover {
    position: absolute;
    width: 100%;
    height: 100%;
    background-color: #EBF8FF;
    background-image: url("/images/photo_cover.webp");
    background-size: cover;
    background-repeat: no-repeat;
    background-position: right center;
  }

  paper-material {
    width: calc(100% - 32px);
    max-width: calc(8.5in - (32px * 3));
    max-height: calc(100% - 32px);
    margin: 16px auto;
    padding: 16px;
    border-radius: 2px;
    background: rgba(100%, 100%, 100%, 0.95);
    overflow: auto;
  }

  #toast .toast-hide-button {
    color: #EEFF41;
    margin: 10px;
  }

  /* Phone */
  @media (max-width: 600px) {
    div.cover {
      background-image: url("/images/photo_noslice.webp");
    }

    paper-material {
      border-radius: 0px;
    }
  }

  @media print {
    body {
      background: white;
      overflow: inherit;
    }

    div.cover {
      display: none;
    }

    paper-material {
      box-shadow: 0 0 0 0 !important;
      border-radius: 0;
      width: inherit;
      max-width: inherit;
      max-height: inherit;
      margin: 0 auto;
      background: white;
      overflow: visible;
      position: absolute;
      top: 0;
    }
  }

  </style>

  <app-location route="{{route}}"></app-location>
  <app-route
      route="{{route}}"
      pattern="/:path"
      data="{{routeData}}"></app-route>

  <div class="cover"></div>

  <!-- Main Content -->
  <div class="content">
    <neon-animated-pages attr-for-selected="data-route" selected="[[routeData.path]]" entry-animation="{{entryAnimation}}" exit-animation="{{exitAnimation}}">

      <neon-animatable data-route="">
        <paper-material elevation="5">
          <about-me></about-me>
        </paper-material>
      </neon-animatable>

      <neon-animatable data-route="resume">
        <paper-material elevation="5">
          <my-resume></my-resume>
        </paper-material>
      </neon-animatable>

    </neon-animated-pages>
  </div>

  <paper-toast id="toast">
    <span class="toast-hide-button" role="button" tabindex="0" onclick="app.$.toast.hide()">OK</span>
  </paper-toast>

</template>

<script>

class ResumeApp extends Polymer.Element {
  static get is() { return 'resume-app'; }

  static get properties() {
    return {
      entryAnimation: {
        type: String,
        value: 'slide-from-bottom-animation',
      },
      exitAnimation: {
        type: String,
        value: 'slide-up-animation',
      },
    };
  }

  static get observers() {
    return [
      '_routeChanged(routeData.*)',
    ];
  }

  windowTitle(path) {
    if (path === '') {
      return 'Christian De Angelis';
    } else if (path === 'resume') {
      return 'Resume â€“ Christian De Angelis';
    } else {
      return 'Christian De Angelis';
    }
  }

  lazyGroup(path) {
    if (path === '') {
      return 'home';
    } else if (path === 'resume') {
      return 'resume';
    } else {
      return undefined;
    }
  }

  connectedCallback() {
    super.connectedCallback();

    if (this.route.path === undefined) {
      this.go();
    }
  }

  _routeChanged(changeRecord) {
    var path = changeRecord.value.path;

    if (path == undefined) {
      return; // no path change to report
    }

    var lazyGroup = this.lazyGroup(path);
    if (lazyGroup) {
      this.importLazyGroup(lazyGroup).then((results) => {
        this.dispatchEvent(new CustomEvent('import-loaded', results));
      });
    }

    document.title = this.windowTitle(path);
    if (path === '') {
      this.entryAnimation = 'slide-from-bottom-animation';
      this.exitAnimation = 'slide-up-animation';
    } else if (path === 'resume') {
      this.entryAnimation = 'slide-from-top-animation';
      this.exitAnimation = 'slide-down-animation';
    } else {
      var url = window.location.hostname + '/' + path;
      this.$.toast.text = 'Can\'t find: ' + url + '. Redirecting you to home.';
      this.$.toast.show();
      this.go();
    }
  }

  go(path) {
    path = path || '';
    this.set('route.path', '/' + path);
  }

}

customElements.define(ResumeApp.is, ResumeApp);

</script>
</dom-module>
